<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: 'Segoe UI', 'Roboto', 'Arial', sans-serif;
  scroll-behavior: smooth;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  transition: background 0.18s, color 0.18s;
}

body {
  background: linear-gradient(120deg, #1d2838 0%, #0056a3 100%);
  color: #f4f7fa;
  min-height: 100vh;
  padding-bottom: 0;
}

nav {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px 8vw;
  background: rgba(26, 39, 62, 0.94);
  backdrop-filter: blur(8px);
  border-radius: 0px 0px 18px 18px;
  box-shadow: 0 3px 16px rgba(0,0,0,0.10);
  margin-bottom: 0.5em;
  min-height: 60px;
}

nav h2 {
  color: #31e6ff;
  letter-spacing: 2px;
  font-size: 1.45rem;
  font-weight: 700;
  display: flex;
  align-items: center;
  gap: 10px;
  line-height: 1;
  user-select: none;
}

nav div {
  display: flex;
  gap: 8px;
}

nav a {
  color: #e9fdff;
  text-decoration: none;
  margin: 0;
  font-weight: 600;
  border-radius: 6px;
  padding: 7px 14px;
  font-size: 1.01rem;
  transition: background 0.12s, color 0.12s, box-shadow 0.12s;
  border: 1px solid transparent;
}

nav a:hover, nav a.active {
  color: #0b2547;
  background: linear-gradient(90deg, #4ef3ff 25%, #00eafd 100%);
  box-shadow: 0 2px 10px #4ef3ff38;
  border-color: #63ffff77;
}

.container {
  padding: 36px 3vw 24px 3vw;
  max-width: 1050px;
  margin: 0 auto 0 auto;
  display: flex;
  flex-direction: column;
  align-items: stretch;
  background: rgba(17,31,62,0.13);
  border-radius: 18px;
  margin-top: 24px;
  box-shadow: 0 2px 22px 0 #00a6d633;
}

.title {
  text-align: center;
  margin-bottom: 20px;
  margin-left: auto;
  margin-right: auto;
  padding: 10px 0 0 0;
}

.title h1 {
  font-size: 2.09rem;
  background: linear-gradient(90deg, #53fff6 30%, #3e77ff 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  font-weight: 900;
  letter-spacing: 0.5px;
  margin-bottom: 7px;
  line-height: 1.17;
}

.title p {
  color: #b3daf7;
  font-size: 1.08rem;
  line-height: 1.46;
  margin-inline: 10px;
  padding: 0 0 2px 0;
}

.cards {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
  gap: 16px 18px;
  justify-items: center;
  margin-top: 8px;
}

.card {
  background: rgba(255,255,255,0.11);
  width: 100%;
  min-width: 0;
  padding: 18px 14px 16px 14px;
  border-radius: 17px;
  text-align: left;
  box-shadow: 0 2px 13px rgba(0,40,90,.13), 0 1px 2px #16e3ff18;
  transition: transform 0.18s, box-shadow 0.18s, border 0.15s;
  border: 1.2px solid rgba(78,243,255,0.06);
  backdrop-filter: blur(2px);
  display: flex;
  flex-direction: column;
  gap: 0.50em;
  position: relative;
  cursor: pointer;
}

.card:hover {
  transform: translateY(-3px) scale(1.021) rotate(-0.5deg);
  box-shadow: 0 6px 32px rgba(0,40,90,0.13), 0 5px 15px #00eaff31;
  border-color: #37e6fd;
  background: rgba(250,255,255,0.15);
}

.card h3 {
  margin-bottom: 2px;
  font-size: 1.12rem;
  color: #24d6ff;
  letter-spacing: 0.4px;
  font-weight: 700;
  display: flex;
  align-items: center;
  gap: 6px;
}

.card p {
  color: #e2f8fd;
  font-size: 0.96rem;
  line-height: 1.5;
  margin-bottom: 1px;
}

.card .status {
  font-weight: bold;
  font-size: 1.01rem;
}

.card .risk-details {
  color: #7ad7f7;
  font-size: 0.92rem;
  margin-top: 1px;
}

.card .trend {
  font-size: 0.95rem;
  color: #ffad7b;
  font-weight: 600;
  margin-top: 2px;
}

footer {
  text-align: center;
  padding: 12px 5px 11px 5px;
  background: rgba(20, 30, 48, 0.92);
  margin-top: 36px;
  color: #90c9fa;
  font-size: 0.97rem;
  border-radius: 12px 12px 0px 0px;
  backdrop-filter: blur(1.5px);
  box-shadow: 0 -1.5px 10px #004e9255;
  opacity: 0.92;
}

@media (max-width: 980px) {
  .container {
    padding: 16px 8px 12px 8px;
    margin-top: 13px;
  }
  .title h1 {
    font-size: 1.3rem;
  }
  .title p {
    font-size: 0.91rem;
  }
}

@media (max-width: 720px) {
  nav {flex-direction: column; gap: 11px; padding: 10px 4vw;}
  .container {padding: 8px 3vw 12px 3vw;}
  .cards {gap: 12px;}
}

@media (max-width: 600px) {
  nav { flex-direction: column; gap: 7px; padding: 6px 2vw; min-height: 45px; }
  nav h2 { font-size: 1.09rem; }
  .title h1 { font-size: 1.03rem;}
  .title p { font-size: 0.81rem;}
  .container { margin-top: 10px; padding: 4px 1.5vw 7px 1.5vw; border-radius: 8px;}
  .cards {grid-template-columns: 1fr; gap: 9px; margin-top: 0;}
  .card { padding: 10px 8px 12px 8px; border-radius: 10px;}
  footer { font-size: 0.90rem; border-radius: 7px 7px 0px 0px; margin-top: 15px;}
}
</style>
<!DOCTYPE html>
<html>
<head>
<title>Dashboard | Climate Risk Dashboard</title>
<!-- paste COMMON STYLE here -->
</head>
<body>
<script>
/* ===== OPENWEATHER API DETAILS ===== */
const API_KEY = "6145616b7ccd1ab6d81f2964cd90e033";
const CITY = "Chennai";

// Utility to format time
function formatTime(date) {
  return date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
}

let latestDashboardData = {
  temperature: null,
  rainfall: null,
  humidity: null,
  apiTime: null,         // when weather API data was last fetched
  alertMsg: "",
  heatAlert: "Low",
  heatAlertColor: "#24d6ff",
  floodRisk: "Low",
  floodRiskColor: "#24d6ff",
  overallRisk: "Stable",
  overallRiskColor: "#5af39b",
};

function updateDashboardVars(temperature, rainfall, humidity, lastUpdated) {
  // Compute dashboard variables and store to latestDashboardData for repeated use
  // Heat Alert Logic
  let heatAlert = "Low";
  let heatAlertColor = "#24d6ff";
  if (temperature > 40) {
    heatAlert = "High";
    heatAlertColor = "#ff7e4b";
  } else if (temperature > 35) {
    heatAlert = "Moderate";
    heatAlertColor = "#ffe44e";
  }

  // Flood Risk Logic
  let floodRisk = "Low";
  let floodRiskColor = "#24d6ff";
  if (rainfall > 50) {
    floodRisk = "High";
    floodRiskColor = "#ff7e4b";
  } else if (rainfall > 20) {
    floodRisk = "Moderate";
    floodRiskColor = "#ffe44e";
  }

  // Overall risk logic
  let overallRisk = "Stable";
  let overallRiskColor = "#5af39b";
  if ((heatAlert === "High" && floodRisk !== "Low") || floodRisk === "High") {
    overallRisk = "Alert";
    overallRiskColor = "#ff7e4b";
  } else if (heatAlert === "Moderate" || floodRisk === "Moderate") {
    overallRisk = "Caution";
    overallRiskColor = "#ffe44e";
  }

  const alertMsg = (heatAlert === "High")
    ? "Extreme heat - Stay indoors and hydrated"
    : (floodRisk === "High")
    ? "Heavy rainfall/Flood possible"
    : "Be alert & stay safe";

  latestDashboardData = {
    temperature,
    rainfall,
    humidity,
    apiTime: lastUpdated,
    alertMsg,
    heatAlert,
    heatAlertColor,
    floodRisk,
    floodRiskColor,
    overallRisk,
    overallRiskColor
  };
}

function updateDashboardCards() {
  // Updates all cards EXCEPT the alerts-status time, which can be kept lively separately
  const {
    temperature, rainfall, humidity, heatAlert, heatAlertColor,
    floodRisk, floodRiskColor, overallRisk, overallRiskColor
  } = latestDashboardData;

  document.getElementById("flood-status").innerHTML = `Status: <span style="color:${floodRiskColor};">${floodRisk}</span>`;
  document.getElementById("flood-details").innerHTML = `Rainfall (last hour): <b>${rainfall} mm</b><br/>River conditions: ${rainfall > 20 ? 'Rising' : 'Stable'}`;
  document.getElementById("flood-trend").innerText = rainfall > 20 ? "‚ö†Ô∏è Upward Trend" : "Steady";

  document.getElementById("heat-status").innerHTML = `Status: <span style="color:${heatAlertColor};">${heatAlert}</span>`;
  document.getElementById("heat-details").innerHTML = `Peak: ${temperature}&deg;C today<br>Humidity: ${humidity !== undefined ? humidity + "%" : "--"}`;
  document.getElementById("heat-trend").innerText = heatAlert === "High" ? "üí° Heatwave alert in effect" : (heatAlert === "Moderate" ? "‚ö†Ô∏è Heat precautions suggested" : "Normal");

  document.getElementById("overall-status").innerHTML = `Status: <span style="color:${overallRiskColor};">${overallRisk}</span>`;
  document.getElementById("overall-details").innerHTML = (overallRisk === "Alert")
    ? "Combined flood/heat risk, extra caution advised"
    : (overallRisk === "Caution")
      ? "Elevated risk - monitor updates" : "No major hazards";
  document.getElementById("overall-trend").innerText = overallRisk === "Alert" ? "üö® Stay tuned for updates" : "‚úÖ Stable";

  document.getElementById("alerts-details").innerHTML = `
    Flood risk: <b>${floodRisk}</b> | Heat: <b>${heatAlert}</b>
    <br>
    Temp: <b>${temperature}&deg;C</b>, Rainfall: <b>${rainfall}mm</b>, Humidity: <b>${humidity !== undefined ? humidity + "%" : "--"}</b>
  `;
  document.getElementById("alerts-trend").innerText = (overallRisk === "Alert")
      ? "üö® Emergency channels open"
      : (heatAlert === "High" ? "üå°Ô∏è Drinking water posts open" : "üì° No special advisories");
}

function updateAlertsStatusLive() {
  // This will update ONLY the time portion of the "Recent Alerts" card in real time
  // Show as "Last Update: [current time] - [latest alert message]"

  const statusElem = document.getElementById("alerts-status");
  const { alertMsg, apiTime } = latestDashboardData;

  // live clock time (current local time, not data fetch time)
  const nowTime = formatTime(new Date());

  // Show API update time too if you want: (Optional: uncomment below line)
  // const apiTimeDisplay = apiTime ? ` (Data as of ${apiTime})` : '';

  // You may display just live time, or both. Let's display both, for clarity.
  const apiTimeDisplay = apiTime ? ` <span style="font-size:0.94em;opacity:0.7;"></span>` : '';

  statusElem.innerHTML = `Last Update: ${nowTime} &nbsp; - &nbsp;<span style="color:#bb96fe;">${alertMsg}</span>${apiTimeDisplay}`;
}

// Set up the lively time updating mechanism
let liveAlertsInterval = null;
function setupLiveAlertsStatus() {
  // Update every second
  if (liveAlertsInterval) clearInterval(liveAlertsInterval);
  liveAlertsInterval = setInterval(updateAlertsStatusLive, 1000);
}

// Main function to update dashboard with live API values
function updateDashboard(temperature, rainfall, humidity, lastUpdated) {
  updateDashboardVars(temperature, rainfall, humidity, lastUpdated);
  updateDashboardCards();
  updateAlertsStatusLive();
  setupLiveAlertsStatus();
}

// Fetch real-time weather data and update the dashboard
fetch(`https://api.openweathermap.org/data/2.5/weather?q=${CITY}&appid=${API_KEY}&units=metric`)
  .then(response => response.json())
  .then(data => {
    const temperature = data.main.temp;
    const humidity = data.main.humidity;
    let rainfall = 0;
    if (data.rain && data.rain["1h"]) {
      rainfall = data.rain["1h"];
    }
    updateDashboard(temperature, rainfall, humidity, formatTime(new Date(data.dt * 1000)));
  })
  .catch(error => {
    // Display static error states
    document.getElementById("flood-status").innerHTML = 'Status: <span style="color:#ccc;">--</span>';
    document.getElementById("flood-details").innerHTML = `Unable to fetch data<br/>--`;
    document.getElementById("flood-trend").innerText = 'No data';

    document.getElementById("heat-status").innerHTML = 'Status: <span style="color:#ccc;">--</span>';
    document.getElementById("heat-details").innerHTML = `Unable to fetch data<br/>--`;
    document.getElementById("heat-trend").innerText = 'No data';

    document.getElementById("overall-status").innerHTML = 'Status: <span style="color:#ccc;">--</span>';
    document.getElementById("overall-details").innerHTML = "Unable to load status";
    document.getElementById("overall-trend").innerText = 'No data';

    document.getElementById("alerts-status").innerHTML = 'Last Update: -- &nbsp; - &nbsp;<span style="color:#ccc;">Unavailable</span>';
    document.getElementById("alerts-details").innerHTML = "No live data";
    document.getElementById("alerts-trend").innerText = "No alerts";
    if (liveAlertsInterval) clearInterval(liveAlertsInterval);
    console.error(error);
  });

// Add click handler for "View Directions"
document.addEventListener("DOMContentLoaded", function() {
  var viewDirections = document.getElementById("view-directions-link");
  if (viewDirections) {
    viewDirections.addEventListener("click", function(e) {
      e.preventDefault();
      // Update the Google Maps link below as appropriate if you want a real location!
      window.open("https://www.google.com/maps/search/?api=1&query=Riverside+Hall+Chennai", "_blank");
    });
  }
});
</script>

<nav>
  <h2>üåç <span style="color:#b1eaff;">ClimateRisk</span></h2>
  <div>
    <a href="index.html">Home</a>
    <a href="dashboard.html" class="active">Dashboard</a>
    <a href="flood.html">Flood</a>
    <a href="heat.html">Heat</a>
    <a href="response.html">Response</a>
  </div>
</nav>

<div class="container">
  <div class="title">
    <h1>Risk Dashboard: Real-time Climate Warnings</h1>
    <p>Summary of current climate hazards and safety levels for your region</p>
  </div>
  <div class="cards">
    <div class="card" style="border-top: 4px solid #24d6ff;">
      <h3>üåä Flood Level</h3>
      <span class="status" id="flood-status">Status: <span style="color:#31e6ff;">--</span></span>
      <div class="risk-details" id="flood-details">Loading river conditions...</div>
      <div class="trend" id="flood-trend">Loading...</div>
    </div>
    <div class="card" style="border-top: 4px solid #ff9572;">
      <h3>üî• Heat Level</h3>
      <span class="status" id="heat-status">Status: <span style="color:#ffad72;">--</span></span>
      <div class="risk-details" id="heat-details">Loading temperature &amp; humidity...</div>
      <div class="trend" id="heat-trend">Loading...</div>
    </div>
    <div class="card" style="border-top: 4px solid #5af39b;">
      <h3>üö¶ Overall Risk</h3>
      <span class="status" id="overall-status">Status: <span style="color:#5af39b;">--</span></span>
      <div class="risk-details" id="overall-details">Calculating risk...</div>
      <div class="trend" id="overall-trend">Loading...</div>
    </div>
    <div class="card" style="border-top: 4px solid #ffe44e;">
      <h3>üìç Latest Shelter Openings</h3>
      <span class="status">Now open: 2 local community centers</span>
      <div class="risk-details">Nearest: Riverside Hall (1.5km) <br> Evacuation: Not required</div>
      <div class="trend" style="color:#ffe44e;">
        üó∫Ô∏è <a id="view-directions-link" href="#" style="color:#ffe44e;text-decoration:underline;cursor:pointer;">View Directions</a>
      </div>
    </div>
    <div class="card" style="border-top: 4px solid #bb96fe;">
      <h3>üì£ Recent Alerts</h3>
      <span class="status" id="alerts-status">Last Update: -- &nbsp; - &nbsp;<span style="color:#bb96fe;">Loading...</span></span>
      <div class="risk-details" id="alerts-details">Fetching advisories...</div>
      <div class="trend" id="alerts-trend" style="color:#bb96fe;">Loading...</div>
    </div>
  </div>
</div>

<footer>Web Programming Project &nbsp;</footer>
</body>
</html>
