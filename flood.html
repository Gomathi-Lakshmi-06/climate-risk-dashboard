<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: 'Segoe UI', 'Roboto', 'Arial', sans-serif;
  scroll-behavior: smooth;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  transition: background 0.18s, color 0.18s;
}

body {
  background: linear-gradient(120deg, #1d2838 0%, #0056a3 100%);
  color: #f4f7fa;
  min-height: 100vh;
  padding-bottom: 0;
}

nav {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px 8vw;
  background: rgba(26, 39, 62, 0.94);
  backdrop-filter: blur(8px);
  border-radius: 0px 0px 18px 18px;
  box-shadow: 0 3px 16px rgba(0,0,0,0.10);
  margin-bottom: 0.5em;
  min-height: 60px;
}

nav h2 {
  color: #31e6ff;
  letter-spacing: 2px;
  font-size: 1.45rem;
  font-weight: 700;
  display: flex;
  align-items: center;
  gap: 10px;
  line-height: 1;
  user-select: none;
}

nav div {
  display: flex;
  gap: 8px;
}

nav a {
  color: #e9fdff;
  text-decoration: none;
  margin: 0;
  font-weight: 600;
  border-radius: 6px;
  padding: 7px 14px;
  font-size: 1.01rem;
  transition: background 0.12s, color 0.12s, box-shadow 0.12s;
  border: 1px solid transparent;
}

nav a:hover, nav a.active {
  color: #0b2547;
  background: linear-gradient(90deg, #4ef3ff 25%, #00eafd 100%);
  box-shadow: 0 2px 10px #4ef3ff38;
  border-color: #63ffff77;
}

.container {
  padding: 36px 3vw 28px 3vw;
  max-width: 1050px;
  margin: 0 auto 0 auto;
  display: flex;
  flex-direction: column;
  align-items: stretch;
  background: rgba(17,31,62,0.10);
  border-radius: 18px;
  margin-top: 24px;
  box-shadow: 0 2px 22px 0 #00a6d633;
}

.title {
  text-align: center;
  margin-bottom: 20px;
  margin-left: auto;
  margin-right: auto;
  padding: 10px 0 0 0;
}

.title h1 {
  font-size: 2.2rem;
  background: linear-gradient(90deg, #53fff6 30%, #3e77ff 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  font-weight: 900;
  letter-spacing: 0.4px;
  margin-bottom: 7px;
  line-height: 1.16;
}

.title p {
  color: #b3daf7;
  font-size: 1.06rem;
  line-height: 1.46;
  margin-inline: 10px;
  padding: 0 0 2px 0;
}

.cards {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 18px 22px;
  justify-items: center;
  margin-top: 6px;
}

.card {
  background: rgba(255,255,255,0.10);
  width: 100%;
  min-width: 0;
  padding: 20px 16px 18px 16px;
  border-radius: 20px;
  text-align: left;
  box-shadow: 0 2px 14px rgba(0,40,90,.14), 0 1px 2px #16e3ff18;
  transition: transform 0.18s, box-shadow 0.18s, border 0.15s;
  cursor: pointer;
  border: 1.2px solid rgba(78,243,255,0.06);
  backdrop-filter: blur(2px);
  position: relative;
  display: flex;
  flex-direction: column;
  gap: 0.7em;
}

.card:hover {
  transform: translateY(-3px) scale(1.025) rotate(-0.5deg);
  box-shadow: 0 6px 32px rgba(0,40,90,0.16), 0 6px 16px #00eaff38;
  border-color: #37e6fd;
  background: rgba(250,255,255,0.14);
}

.card h3 {
  margin-bottom: 2px;
  font-size: 1.15rem;
  color: #24d6ff;
  letter-spacing: 0.5px;
  font-weight: 700;
}

.card p {
  color: #e2f8fd;
  font-size: 0.98rem;
  line-height: 1.5;
}

/* Footer - less empty space, more subtle style */
footer {
  text-align: center;
  padding: 12px 5px 11px 5px;
  background: rgba(20, 30, 48, 0.92);
  margin-top: 36px;
  color: #90c9fa;
  font-size: 0.97rem;
  border-radius: 12px 12px 0px 0px;
  backdrop-filter: blur(1.5px);
  box-shadow: 0 -1.5px 10px #004e9255;
  opacity: 0.92;
}

.map-modal-overlay {
  display: none;
  position: fixed;
  z-index: 2000;
  left: 0; top: 0; right: 0; bottom: 0;
  background: rgba(0,20,33,0.56);
  justify-content: center;
  align-items: center;
}

.map-modal {
  background: #0e2235;
  border-radius: 14px;
  box-shadow: 0 8px 32px #00cfed88;
  max-width: 93vw;
  width: 430px;
  padding: 0 0 18px 0;
  position: relative;
  text-align: center;
  animation: fadein .18s;
}

@keyframes fadein {
  from { opacity: 0; transform: scale(0.91);}
  to   { opacity: 1; transform: scale(1);}
}
.map-modal-close {
  position: absolute;
  right: 16px;
  top: 8px;
  font-size: 2rem;
  color: #5af39b;
  background: transparent;
  border: none;
  cursor: pointer;
  font-weight: bold;
  transition: color 0.17s;
  z-index: 25;
}
.map-modal-close:hover { color: #fc4242; }
.map-modal-title {
  font-size: 1.18rem;
  margin-top:13px;
  margin-bottom: 6px;
  color: #24d6ff;
  font-weight: bold;
  letter-spacing: 0.5px;
}
.map-modal-address {
  color: #c5fef4;
  font-size: 1.01rem;
  margin-bottom: 8px;
  line-height: 1.5;
}
.map-modal-iframe {
  width: 98%;
  height: 250px;
  border: none;
  border-radius: 8px;
  box-shadow: 0 2px 10px #0edbda33;
  margin-bottom: 7px;
}
@media (max-width: 600px) {
  .map-modal {width: 99vw;}
  .map-modal-iframe {height: 160px;}
}

@media (max-width: 960px) {
  .container {
    padding: 23px 8px 18px 8px;
    margin-top: 16px;
  }
  .title h1 {
    font-size: 1.31rem;
  }
  .title p {
    font-size: 0.92rem;
  }
}

@media (max-width: 720px) {
  nav {flex-direction: column; gap: 11px; padding: 11px 4vw;}
  .container {padding: 10px 3vw 15px 3vw;}
  .cards {gap: 15px;}
}

@media (max-width: 600px) {
  nav {
    flex-direction: column; 
    gap: 8px; 
    padding: 6px 2vw;
    min-height: 44px;
  }
  nav h2 {
    font-size: 1rem;
  }
  .title h1 {
    font-size: 1.15rem;
    margin-bottom: 4px;
  }
  .title p {
    font-size: 0.83rem;
  }
  .container {
    margin-top: 10px;
    padding: 4px 2vw 8px 2vw;
    border-radius: 8px;
  }
  .cards {
    grid-template-columns: 1fr;
    gap: 10px;
    margin-top: 0;
  }
  .card {
    padding: 10px 8px 12px 8px;
    border-radius: 11px;
  }
  footer {
    font-size: 0.91rem;
    border-radius: 8px 8px 0px 0px;
    margin-top: 16px;
  }
}
</style>
<!DOCTYPE html>
<html>
<head>
<title>Flood | Climate Risk Dashboard</title>
</head>
<body>

<nav>
  <h2>üåç <span style="color:#b1eaff;">ClimateRisk</span></h2>
  <div>
    <a href="index.html">Home</a>
    <a href="dashboard.html">Dashboard</a>
    <a href="flood.html" class="active">Flood</a>
    <a href="heat.html">Heat</a>
    <a href="response.html">Response</a>
  </div>
</nav>

<div class="container">
  <div class="title">
    <h1>Flood Risk & Awareness Dashboard</h1>
    <p>Real-time flood alerts, risk levels, and essential safety resources for your community</p>
  </div>
  <div class="cards">

    <!-- LIVE FLOOD DATA CARD-->
    <div class="card" style="border-top: 4px solid #24d6ff;" id="live-flood-card">
      <h3>üåä Current Flood Risk</h3>
      <div id="flood-output">
        <span style="color: #aaa;">Loading real-time flood data...</span>
      </div>
      <div id="flood-update-time" style="color:#7ad7f7;font-size:0.92rem; margin-top:3px;">
      </div>
    </div>

    <div class="card" style="border-top: 4px solid #ffe44e;">
      <h3>‚ö†Ô∏è Advisory & Precaution</h3>
      <p>‚Ä¢ Avoid low-lying or flood-prone areas<br>
         ‚Ä¢ Do not walk or drive through flooded roads<br>
         ‚Ä¢ Prepare emergency supplies and monitor local alerts</p>
      <div style="color:#ffe44e;font-size:0.96rem;">Evacuation: <span style="font-weight:bold;">Not required</span> at this time</div>
    </div>
    <div class="card" style="border-top: 4px solid #5af39b;">
      <h3>üè† Nearest Relief Centers</h3>
      <p>
        üè• Riverside Hall (1.5km) - <span style="color:#5af39b;">Open</span><br>
        üè¢ Community Gym (2.2km) - <span style="color:#5af39b;">Standby</span>
      </p>
      <div style="color:#5af39b;font-size:0.93rem;">
        üó∫Ô∏è 
        <a
          href="#"
          id="view-directions-link"
          style="color:#5af39b;text-decoration: underline;"
        >View directions</a>
      </div>
    </div>
    <div class="card" style="border-top: 4px solid #bb96fe;">
      <h3>üì£ Recent Flood Alerts</h3>
      <div id="recent-flood-alerts">
        <span style="color:#aaa;">Loading latest flood alerts...</span>
      </div>
      <div style="color:#bb96fe;font-size:0.95rem;" id="lightning-alert">üì° Lightning risk: <span style="color:#bbb;">Low</span></div>
    </div>
  </div>
</div>

<!-- Map Modal for Directions -->
<div class="map-modal-overlay" id="map-modal-overlay" tabindex="-1" aria-modal="true" role="dialog">
  <div class="map-modal">
    <button class="map-modal-close" id="close-map-modal" title="Close map" aria-label="Close">&times;</button>
    <div class="map-modal-title" id="map-modal-title"></div>
    <div class="map-modal-address" id="map-modal-address"></div>
    <iframe
      id="map-modal-iframe"
      class="map-modal-iframe"
      src=""
      allowfullscreen
      loading="lazy"
      referrerpolicy="no-referrer-when-downgrade"
      title="Directions map"
    ></iframe>
  </div>
</div>

<footer>Web Programming Project &nbsp;</footer>

<script>
/**
 * This script fetches live rainfall data and updates the flood dashboard card.
 * It also updates the recent flood alerts card based on the live data.
 * Make sure to place your API KEY accordingly (done for you!).
 */
const apiKey = "6145616b7ccd1ab6d81f2964cd90e033";
const city = "Chennai";

/**
 * Formats the current time to HH:MM format (24hr).
 */
function getCurrentTimeString() {
  const now = new Date();
  return now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
}

// Create a function to generate alert messages based on rainfall/risk
function getFloodAlertHtml(rainfall, risk, updateTime) {
  if (risk === "High") {
    return `
      <p>
        <span style="color:#bb96fe;font-weight:600;">${updateTime}:</span>
        <span style="color:#fc4242;font-weight:600;"> Severe Flood Risk!</span> Evacuate low-lying areas, avoid all travel.<br>
        <span style="color:#bb96fe;font-weight:600;">${updateTime}:</span>
        Continuous heavy rainfall detected. Emergency services on alert.
      </p>`;
  } else if (risk === "Moderate") {
    return `
      <p>
        <span style="color:#bb96fe;font-weight:600;">${updateTime}:</span>
        <span style="color:#ffd342;font-weight:600;"> Flood Watch in effect.</span> Moderate rainfall: Stay alert for flash floods.<br>
        <span style="color:#bb96fe;font-weight:600;">${updateTime}:</span>
        Pooling/ponding possible in low-lying zones.
      </p>`;
  } else if (rainfall > 0) {
    return `
      <p>
        <span style="color:#bb96fe;font-weight:600;">${updateTime}:</span>
        <span style="color:#31e6ff;font-weight:600;"> Low flood risk.</span> Light rainfall observed.<br>
        <span style="color:#bb96fe;font-weight:600;">${updateTime}:</span>
        No flooding anticipated. Stay aware of further updates.
      </p>`;
  } else {
    return `
      <p>
        <span style="color:#bb96fe;font-weight:600;">${updateTime}:</span>
        <span style="color:#31e6ff;font-weight:600;"> No flood alerts.</span> No rainfall detected.<br>
        <span style="color:#bb96fe;font-weight:600;">${updateTime}:</span>
        Safe conditions. Monitor for any changes.
      </p>`;
  }
}

// Optionally, update the lightning alert depending on weather conditions
function updateLightningAlert(data) {
  let lightningHtml = 'üì° Lightning risk: <span style="color:#bbb;">Low</span>';
  // If thunderstorm in weather conditions, set alert high
  if (
    data.weather &&
    Array.isArray(data.weather) &&
    data.weather.some(w => w.main && w.main.toLowerCase().includes('thunderstorm'))
  ) {
    lightningHtml = 'üì° Lightning risk: <span style="color:#fc4242;font-weight:600;">High</span> <span style="color:#bb96fe;">(Thunderstorm detected)</span>';
  }
  document.getElementById('lightning-alert').innerHTML = lightningHtml;
}

function updateFloodData() {
  fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&units=metric`)
    .then(res => res.json())
    .then(data => {
      let rainfall = 0;
      if (data.rain && data.rain["1h"]) {
        rainfall = data.rain["1h"];
      }

      let risk = "Low";
      let riskColor = "#31e6ff";
      if (rainfall > 50) {
        risk = "High";
        riskColor = "#fc4242";
      } else if (rainfall > 20) {
        risk = "Moderate";
        riskColor = "#ffd342";
      }

      // Update time
      const now = new Date();
      const timeStr = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });
      const timeShort = getCurrentTimeString();

      document.getElementById("flood-output").innerHTML = `
        üåßÔ∏è Rainfall (last 1 hour): <b>${rainfall} mm</b><br>
        üö® Flood Risk Level: <b style="color:${riskColor};">${risk}</b>
      `;
      document.getElementById("flood-update-time").innerHTML = `Update: ${timeStr} - Live data from OpenWeatherMap`;

      // Update recent flood alerts dynamically
      document.getElementById("recent-flood-alerts").innerHTML = getFloodAlertHtml(rainfall, risk, timeShort);

      // Update lightning alert
      updateLightningAlert(data);
    })
    .catch(err => {
      document.getElementById("flood-output").innerHTML =
        "<span style='color:#fc4242;'>Unable to fetch flood data (check internet or API key limit reached).</span>";
      document.getElementById("flood-update-time").innerText = "";
      document.getElementById("recent-flood-alerts").innerHTML =
        "<span style='color:#fc4242;'>Unable to load latest alerts (offline or API limit reached).</span>";
      document.getElementById("lightning-alert").innerHTML =
        'üì° Lightning risk: <span style="color:#bbb;">Unknown</span>';
      console.error(err);
    });
}

// Map/Relief Centers Info
const reliefCenters = [
  {
    name: "Riverside Hall",
    address: "123 Riverside Rd, Chennai",
    place: "Riverside Hall, Chennai",
    googleMapsEmbed: "https://www.google.com/maps?q=Riverside+Hall,+Chennai&output=embed"
  },
  {
    name: "Community Gym",
    address: "45 Gym Ave, Chennai",
    place: "Community Gym, Chennai",
    googleMapsEmbed: "https://www.google.com/maps?q=Community+Gym,+Chennai&output=embed"
  }
];

// Handle 'View directions' click to show map in modal
document.addEventListener("DOMContentLoaded", function () {
  // Initial fetch when page loads
  updateFloodData();
  // Optionally, update the data every 5 minutes for live effect
  setInterval(updateFloodData, 5 * 60 * 1000); // 5 minutes (300000 ms)

  document.getElementById("view-directions-link").addEventListener("click", function (e) {
    e.preventDefault();
    // Show a simple selection popup if multiple centers, else show first
    showMapModal(reliefCenters[0]);
  });

  // Modal elements
  const overlay = document.getElementById("map-modal-overlay");
  const closeBtn = document.getElementById("close-map-modal");

  // Trap focus on modal when open (optionally for accessibility)
  closeBtn.addEventListener("click", closeMapModal);
  overlay.addEventListener("click", function(e){
    if (e.target === overlay) closeMapModal();
  });
  document.addEventListener("keydown", function (e) {
    if (overlay.style.display === "flex" && (e.key === "Escape" || e.keyCode === 27)) {
      closeMapModal();
    }
  });
});

// Open the map modal for a location
function showMapModal(location) {
  var overlay = document.getElementById("map-modal-overlay");
  document.getElementById("map-modal-title").textContent = `Directions to ${location.name}`;
  document.getElementById("map-modal-address").textContent = location.address;
  document.getElementById("map-modal-iframe").src = location.googleMapsEmbed;
  overlay.style.display = "flex";
  // Set focus to close button for accessibility
  document.getElementById("close-map-modal").focus();
}

// Close map modal
function closeMapModal() {
  var overlay = document.getElementById("map-modal-overlay");
  overlay.style.display = "none";
  document.getElementById("map-modal-iframe").src = "";
}
</script>

</body>
</html>
